<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shaka Player (Simple ‚Ä¢ Locked)</title>
  <!-- Shaka Player UI CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.16.1/controls.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body{margin:0;background:#0b0f17;color:#e5e7eb;font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
    .wrap{max-width:960px;margin:0 auto;padding:16px}
    h1{font-size:16px;margin:10px 0 14px 0;font-weight:600;color:#cbd5e1}
    .card{background:#0f172a;border:1px solid rgba(255,255,255,.08);border-radius:14px;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .shaka-video-container{aspect-ratio:16/9;background:#0a0e14}
    video{width:100%;height:100%;display:block}
    .bar{display:flex;align-items:center;gap:8px;justify-content:space-between;margin-top:10px}
    .small{font-size:12px;color:#94a3b8}
    .err{margin-top:10px;padding:10px 12px;border-radius:10px;background:#111827;border:1px solid rgba(255,255,255,.1);display:none}
    .badge{font-size:11px;border:1px solid rgba(255,255,255,.2);padding:3px 8px;border-radius:999px;color:#93c5fd}
    a{color:#93c5fd}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Shaka Player ‚Äî Simple & Locked</h1>
    <div class="card">
      <div id="videoContainer" class="shaka-video-container">
        <video id="video" autoplay playsinline muted></video>
      </div>
    </div>
    <div class="bar">
      <div class="small" id="info">Only whitelisted URL can play</div>
      <div class="badge" id="status">ready</div>
    </div>
    <div class="err" id="errBox"></div>

    <p class="small">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞: <code>?src=&lt;your HLS/DASH url&gt;</code> (‡¶∂‡ßÅ‡¶ß‡ßÅ whitelist-‡¶è ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶™‡ßç‡¶≤‡ßá ‡¶ï‡¶∞‡¶¨‡ßá)‡•§
      <br />‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï: ‡¶∞‡¶ø‡¶™‡ßã ‡¶∞‡ßÅ‡¶ü‡ßá <code>allowed.json</code> ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶≤‡ßá (‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶®‡¶ø‡¶ö‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã), ‡¶∏‡ßá‡¶ñ‡¶æ‡¶®‡¶ï‡¶æ‡¶∞ URL-‡¶ì ‡¶ö‡¶≤‡¶¨‡ßá‡•§
    </p>
    <pre class="small" style="background:#0f172a;border:1px solid rgba(255,255,255,.08);padding:10px;border-radius:10px;overflow:auto">{
  "urls": [
    "https://tataplay.slivcdn.com/hls/live/2020591/TEN3HD/master_664.m3u8",
    "https://example.com/vod/manifest.mpd"
  ]
}</pre>
  </div>

  <!-- Shaka core + UI -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.16.1/shaka-player.compiled.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.16.1/shaka-player.ui.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
  (function(){
    const qs = new URLSearchParams(location.search);
    const $ = (id) => document.getElementById(id);
    const video = $('video');
    const container = $('videoContainer');
    const errBox = $('errBox');
    const info = $('info');
    const status = $('status');

    // üîí ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶è‡¶ó‡ßÅ‡¶≤‡¶ø‡¶á ‡¶™‡ßç‡¶≤‡ßá ‡¶π‡¶¨‡ßá ‚Äî ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ HLS/MPD ‡¶≤‡¶ø‡¶Ç‡¶ï(‡¶ó‡ßÅ‡¶≤‡ßã) ‡¶¨‡¶∏‡¶æ‡¶ì
    const STATIC_ALLOWED = [
      // ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£:
      "https://tataplay.slivcdn.com/hls/live/2020591/TEN3HD/master_664.m3u8",
      // "https://your.cdn.com/manifest.mpd"
    ];

    async function loadAllowedFromJson(){
      try {
        // repo ‡¶∞‡ßÅ‡¶ü‡ßá allowed.json ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ü‡ßá‡¶®‡ßá ‡¶Ü‡¶®‡¶¨‡ßá
        const r = await fetch('allowed.json', { cache: 'no-store' });
        if (!r.ok) return [];
        const j = await r.json();
        return Array.isArray(j.urls) ? j.urls.filter(u => typeof u === 'string') : [];
      } catch { return []; }
    }

    function urlEqual(a, b){
      try { return new URL(a).href === new URL(b).href; } catch { return a === b; }
    }

    function pickManifest(allowed){
      const src = qs.get('src');
      if (src) {
        const ok = allowed.some(u => urlEqual(u, src));
        if (!ok) throw new Error('Not allowed: URL is not in whitelist');
        return src;
      }
      if (!allowed.length) throw new Error('No source given and whitelist empty');
      return allowed[0];
    }

    function showError(msg){
      errBox.style.display = 'block';
      errBox.textContent = msg;
      status.textContent = 'error';
    }

    // Shaka init
    shaka.polyfill.installAll();
    if (!shaka.Player.isBrowserSupported()){
      showError('‡¶è‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ Shaka Player ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ. Chrome/Edge/Firefox ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®.');
      return;
    }

    const player = new shaka.Player(video);
    const ui = new shaka.ui.Overlay(player, container, video);
    ui.configure({
      addSeekBar: true,
      addBigPlayButton: true,
      enableTooltips: true,
      controlPanelElements: ['play_pause','time_and_duration','spacer','mute','volume','playback_rate','picture_in_picture','captions','language','quality','fullscreen','overflow_menu'],
      playbackRates: [0.5, 1, 1.25, 1.5, 2]
    });

    player.configure({
      streaming: { lowLatencyMode: true, bufferingGoal: 1.0, rebufferingGoal: 0.5 },
      manifest: { hls: { ignoreTextStreamFailures: true } },
      abr: { enabled: true, switchInterval: 2 }
    });

    player.addEventListener('error', (e)=> showError('Playback error: ' + (e.detail && e.detail.code))); 

    (async function run(){
      const dyn = await loadAllowedFromJson();
      const ALLOWED = Array.from(new Set([...STATIC_ALLOWED, ...dyn]));
      try {
        const src = pickManifest(ALLOWED);
        info.textContent = new URL(src).hostname + ' ‚Ä¢ locked';
        status.textContent = 'loading';
        await player.load(src);
        status.textContent = 'playing';
        try { await video.play(); } catch { /* user gesture may be needed on mobile */ }
      } catch (err){
        console.error(err);
        showError(err.message || 'Unable to start playback');
      }
    })();
  })();
  </script>
</body>
</html>
