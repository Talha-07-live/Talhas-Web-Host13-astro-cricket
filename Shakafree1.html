<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Shaka Player ‚Äì Fixed HLS</title>

  <!-- Shaka UI CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shaka-player@latest/dist/controls.css">

  <style>
    :root {
      --bg: #0b1020; --card:#111831; --text:#e8eefc; --muted:#9fb3ff; --accent:#5b8cff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      min-height:100dvh; display:grid; place-items:center;
      background: radial-gradient(1100px 420px at 50% -25%, #162246 0%, #0b1020 55%, #070b16 100%);
      color:var(--text);
    }
    .wrap{width:min(1100px,100%); padding:16px}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.015));
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px; overflow:hidden;
      box-shadow:0 8px 30px rgba(0,0,0,.45);
    }
    .brand{
      display:flex; align-items:center; gap:10px; padding:12px 16px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      font-weight:700; letter-spacing:.2px;
    }
    #video-container{
      position:relative; aspect-ratio:16/9; background:#000;
    }
    video{width:100%; height:100%; display:block}
    #unmute{
      position:absolute; right:12px; bottom:12px; z-index:5; display:none;
      background:rgba(0,0,0,.55); color:#fff; padding:8px 12px; border-radius:12px;
      border:1px solid rgba(255,255,255,.16); backdrop-filter:blur(6px);
      font-size:13px; cursor:pointer; align-items:center; gap:8px;
    }
    #toast{
      position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
      background:#192136; color:var(--text); border:1px solid rgba(255,255,255,.14);
      padding:10px 14px; border-radius:10px; font-size:14px;
      box-shadow:0 10px 22px rgba(0,0,0,.45); max-width:min(90vw,680px);
    }
    .hidden{display:none!important}
    .note{
      padding:10px 16px; font-size:12.5px; color:#c7d3ffb3;
      border-top:1px solid rgba(255,255,255,.06);
      background:linear-gradient(180deg, rgba(20,30,60,.65), rgba(12,18,36,.6));
    }
    code{background:#0f1836; padding:.1rem .35rem; border-radius:6px; border:1px solid rgba(255,255,255,.08)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brand">üé¨ My Shaka Player <small style="opacity:.7;font-weight:500">‚Äî Fixed HLS</small></div>

      <div id="video-container" class="shaka-player-container" data-shaka-player-container>
        <video id="video" class="shaka-video" playsinline></video>
        <button id="unmute" title="Tap to unmute">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" aria-hidden="true">
            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3a3.5 3.5 0 00-1.87-3.11v6.22A3.5 3.5 0 0016.5 12zm0-7a10.5 10.5 0 010 14m-2.62-12.62a7.5 7.5 0 010 11.24"/>
          </svg>
          Tap to unmute
        </button>
      </div>

      <div class="note">
        <b>Fixed URL:</b>
        <code id="fixedUrlCode">https://tataplay.slivcdn.com/hls/live/2020591/TEN3HD/master_664.m3u8</code>
        &nbsp;‚Äî ‡¶¨‡¶¶‡¶≤‡¶æ‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßá‡¶∞ <code>STREAM_URL</code> ‡¶ï‡¶®‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
      </div>
    </div>
  </div>

  <div id="toast" class="hidden"></div>

  <!-- Shaka Player (UI build) -->
  <script src="https://cdn.jsdelivr.net/npm/shaka-player@latest/dist/shaka-player.ui.min.js" defer></script>
  <script>
  // ==== EDIT JUST THIS LINE TO CHANGE YOUR FIXED STREAM ====
  const STREAM_URL = 'https://tataplay.slivcdn.com/hls/live/2020591/TEN3HD/master_664.m3u8';
  // ========================================================

  window.addEventListener('load', async () => {
    document.getElementById('fixedUrlCode').textContent = STREAM_URL;

    if (!window.shaka) { return showToast('Shaka Player load failed. Check CDN.', true); }

    shaka.polyfill.installAll();
    if (!shaka.Player.isBrowserSupported()) {
      return showToast('‡¶è‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶Æ‡¶ø‡¶°‡¶ø‡¶Ø‡¶º‡¶æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶° ‡¶®‡¶æ‡•§ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', true);
    }

    const video = document.getElementById('video');
    const container = document.getElementById('video-container');
    const unmute = document.getElementById('unmute');

    // Create Shaka UI overlay
    const ui = new shaka.ui.Overlay(null, container, video);
    const controls = ui.getControls();
    const player = controls.getPlayer();

    // Expose for debugging
    window.player = player; window.ui = ui; window.video = video;

    // UI controls config
    ui.configure({
      addSeekBar: true,
      addBigPlayButton: true,
      controlPanelElements: [
        'play_pause','time_and_duration','spacer','mute','volume',
        'captions','quality','playback_rate','picture_in_picture','fullscreen'
      ],
      overflowMenuButtons: ['captions','audio','quality','playback_rate'],
    });

    // Player streaming config
    player.configure({
      streaming: {
        lowLatencyMode: true,
        rebufferingGoal: 1.5,
        bufferingGoal: 10,
        bufferBehind: 30,
        jumpLargeGaps: true,
        smallGapLimit: 0.5,
        stallEnabled: true,
        useNativeHlsOnSafari: true
      },
      abr: { enabled: true, switchInterval: 8, defaultBandwidthEstimate: 8_000_000 },
      manifest: { retryParameters: { maxAttempts: 8, baseDelay: 500, backoffFactor: 2, fuzzFactor: .5, timeout: 30000 } },
      drm: { servers: {} } // no DRM here (no bypass)
    });

    player.addEventListener('error', (ev) => onShakaError(ev.detail));
    video.addEventListener('error', () => {
      const err = video.error;
      if (err) onFriendlyError(`HTML5 video error (code ${err.code}).`);
    });

    function onShakaError(error) {
      console.error('Shaka error:', error);
      const code = error && (error.code || error);
      let msg = 'Playback error.';
      if (code === shaka.util.Error.Code.BAD_HTTP_STATUS) msg = 'HTTP error: URL blocked/not reachable.';
      else if (code === shaka.util.Error.Code.MANIFEST_UNKNOWN) msg = 'Invalid/unsupported manifest.';
      else if (code === shaka.util.Error.Code.HLS_SEGMENT_PARSING_ERROR) msg = 'HLS segment parsing error.';
      else if (code === shaka.util.Error.Code.NETWORK_HTTP_ERROR) msg = 'Network HTTP error.';
      onFriendlyError(msg);
      try { player.retryStreaming(); } catch {}
    }
    function onFriendlyError(message){ showToast(message + ' (No DRM/CORS bypass)', true); }

    // Tap to unmute helper
    function maybeShowUnmute(){
      if (video.muted || video.volume === 0) unmute.style.display = 'inline-flex';
      else unmute.style.display = 'none';
    }
    unmute.addEventListener('click', () => { video.muted = false; video.volume = Math.max(video.volume, .6); maybeShowUnmute(); });
    video.addEventListener('volumechange', maybeShowUnmute);

    // Persist basic prefs
    const VOL_KEY='sp_vol', MUTE_KEY='sp_muted', RATE_KEY='sp_rate';
    try{
      const v=+localStorage.getItem(VOL_KEY); if(!Number.isNaN(v)) video.volume=Math.min(1,Math.max(0,v));
      video.muted = localStorage.getItem(MUTE_KEY)==='1';
      const r=+localStorage.getItem(RATE_KEY); if(r && r>=.5 && r<=2) video.playbackRate=r;
      video.addEventListener('volumechange',()=>{localStorage.setItem(VOL_KEY,String(video.volume)); localStorage.setItem(MUTE_KEY, video.muted?'1':'0');});
      video.addEventListener('ratechange',()=>localStorage.setItem(RATE_KEY,String(video.playbackRate)));
    }catch{}

    // ---- Auto-start fixed HLS ----
    try{
      await player.load(STREAM_URL);
      // Attempt muted autoplay; if blocked, user can click big play button.
      video.muted = true;
      await video.play().catch(()=>{ /* gesture required, UI big play is visible */ });
      maybeShowUnmute();
      showToast('Playing‚Ä¶', false);
    }catch(err){ onShakaError(err); }

    // Toast utility
    let toastTimer;
    function showToast(text, isErr){
      const t=document.getElementById('toast');
      t.textContent=text; t.classList.toggle('err', !!isErr);
      t.classList.remove('hidden'); clearTimeout(toastTimer);
      toastTimer=setTimeout(()=>t.classList.add('hidden'), 4200);
    }
  });
  </script>
</body>
</html>
